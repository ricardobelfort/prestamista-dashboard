<div class="space-y-8">
  <!-- Header -->
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-foreground flex items-center gap-2">
        <lucide-icon [img]="Home" class="w-7 h-7"></lucide-icon>
        {{ 'home.title' | translate }}
      </h1>
      <p class="text-muted-foreground mt-2 text-lg">{{ 'home.subtitle' | translate }}</p>
    </div>
    <button 
      class="btn btn-outline"
      (click)="exportDashboard()"
      [disabled]="exporting()"
    >
      @if (exporting()) {
        <div class="flex items-center space-x-2">
          <div class="animate-spin rounded-full h-4 w-4 border-2 border-current border-t-transparent"></div>
          <span>{{ 'home.exporting' | translate }}</span>
        </div>
      } @else {
        <lucide-icon [img]="FileSpreadsheet" class="w-4 h-4"></lucide-icon>
        <span>{{ 'home.exportReport' | translate }}</span>
      }
    </button>
  </div>

  <!-- Metrics Cards -->
  @if (loading()) {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      @for (i of [1,2,3,4]; track i) {
        <div class="card p-6">
          <div class="h-8 w-32 bg-slate-200 rounded animate-pulse mb-2"></div>
          <div class="h-10 w-24 bg-slate-200 rounded animate-pulse"></div>
        </div>
      }
    </div>
  } @else {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Total Emprestado -->
      <div class="card p-6 hover:shadow-lg transition-shadow duration-200 border-l-4 border-blue-500">
        <div class="flex items-center justify-between mb-4">
          <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
            <lucide-icon [img]="DollarSign" class="text-blue-600 text-xl"></lucide-icon>
          </div>
        </div>
        <p class="text-sm font-semibold text-muted-foreground mb-1">{{ 'home.totalLoaned' | translate }}</p>
        <p class="text-3xl font-bold text-foreground">{{ metrics().total_loaned | localizedCurrency:'symbol':'1.0-0' }}</p>
        <p class="text-xs text-muted-foreground mt-2">{{ metrics().active_loans }} {{ 'home.activeLoans' | translate }}</p>
      </div>

      <!-- Total Recebido -->
      <div class="card p-6 hover:shadow-lg transition-shadow duration-200 border-l-4 border-emerald-500">
        <div class="flex items-center justify-between mb-4">
          <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center">
            <lucide-icon [img]="Wallet" class="text-emerald-600 text-xl"></lucide-icon>
          </div>
        </div>
        <p class="text-sm font-semibold text-muted-foreground mb-1">{{ 'home.totalReceived' | translate }}</p>
        <p class="text-3xl font-bold text-foreground">{{ metrics().total_received | localizedCurrency:'symbol':'1.0-0' }}</p>
        <div class="flex items-center mt-2 text-xs">
          @if (profitPercentage() > 0) {
            <lucide-icon [img]="ArrowUp" class="text-emerald-600 mr-1"></lucide-icon>
            <span class="text-emerald-600 font-medium">{{ profitPercentage() | number:'1.1-1' }}%</span>
          } @else {
            <span class="text-muted-foreground">0%</span>
          }
          <span class="text-muted-foreground ml-1">{{ 'home.recovery' | translate }}</span>
        </div>
      </div>

      <!-- Lucro -->
      <div class="card p-6 hover:shadow-lg transition-shadow duration-200 border-l-4" 
           [class.border-emerald-500]="metrics().profit >= 0"
           [class.border-red-500]="metrics().profit < 0">
        <div class="flex items-center justify-between mb-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center"
               [class.bg-emerald-100]="metrics().profit >= 0"
               [class.bg-red-100]="metrics().profit < 0">
            <lucide-icon [img]="TrendingUp" 
                     [class.text-emerald-600]="metrics().profit >= 0"
                     [class.text-red-600]="metrics().profit < 0"
                     class="text-xl"></lucide-icon>
          </div>
        </div>
        <p class="text-sm font-semibold text-muted-foreground mb-1">{{ 'home.profit' | translate }}</p>
        <p class="text-3xl font-bold"
           [class.text-emerald-600]="metrics().profit >= 0"
           [class.text-red-600]="metrics().profit < 0">
          {{ metrics().profit | localizedCurrency:'symbol':'1.0-0' }}
        </p>
        <p class="text-xs text-muted-foreground mt-2">
          {{ 'home.expected' | translate }}: {{ metrics().expected_profit | localizedCurrency:'symbol':'1.0-0' }}
        </p>
      </div>

      <!-- Inadimplência -->
      <div class="card p-6 hover:shadow-lg transition-shadow duration-200 border-l-4"
           [class.border-red-500]="metrics().default_rate > 10"
           [class.border-amber-500]="metrics().default_rate > 0 && metrics().default_rate <= 10"
           [class.border-emerald-500]="metrics().default_rate === 0">
        <div class="flex items-center justify-between mb-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center"
               [class.bg-red-100]="metrics().default_rate > 10"
               [class.bg-amber-100]="metrics().default_rate > 0 && metrics().default_rate <= 10"
               [class.bg-emerald-100]="metrics().default_rate === 0">
            <lucide-icon [img]="AlertTriangle"
                     [class.text-red-600]="metrics().default_rate > 10"
                     [class.text-amber-600]="metrics().default_rate > 0 && metrics().default_rate <= 10"
                     [class.text-emerald-600]="metrics().default_rate === 0"
                     class="text-xl"></lucide-icon>
          </div>
        </div>
        <p class="text-sm font-semibold text-muted-foreground mb-1">{{ 'home.defaultRate' | translate }}</p>
        <p class="text-3xl font-bold"
           [class.text-red-600]="metrics().default_rate > 10"
           [class.text-amber-600]="metrics().default_rate > 0 && metrics().default_rate <= 10"
           [class.text-emerald-600]="metrics().default_rate === 0">
          {{ metrics().default_rate }}%
        </p>
        <p class="text-xs text-muted-foreground mt-2">
          {{ metrics().overdue_installments }} {{ 'home.overdueInstallments' | translate }}
        </p>
      </div>
    </div>
  }

  <!-- Upcoming Installments -->
  <div class="card">
    <div class="px-6 py-4 border-b">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold text-foreground flex items-center">
          <lucide-icon [img]="CalendarDays" class="mr-2 text-muted-foreground"></lucide-icon>
          {{ 'home.upcomingPayments' | translate }}
        </h3>
        <span class="text-sm text-muted-foreground">{{ 'home.next7Days' | translate }}</span>
      </div>
    </div>
    
    @if (loadingInstallments()) {
      <div class="p-6">
        <div class="space-y-4">
          @for (i of [1,2,3]; track i) {
            <div class="h-16 bg-slate-200 rounded animate-pulse"></div>
          }
        </div>
      </div>
    } @else if (upcomingInstallments().length === 0) {
      <div class="p-12 text-center">
        <p class="text-muted-foreground">{{ 'home.noUpcomingPayments' | translate }}</p>
      </div>
    } @else {
      <div class="divide-y">
        @for (inst of upcomingInstallments(); track inst.installment_id) {
          <div class="px-6 py-4 hover:bg-muted/50 transition-colors">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <p class="font-medium text-foreground">{{ inst.client_name }}</p>
                <p class="text-sm text-muted-foreground">
                  {{ 'home.installment' | translate }} {{ inst.index_no }} • 
                  {{ inst.due_date | date:'dd/MM/yyyy' }}
                  @if (inst.days_until_due === 0) {
                    <span class="ml-2 text-amber-600 font-medium">{{ 'home.dueToday' | translate }}</span>
                  } @else if (inst.days_until_due === 1) {
                    <span class="ml-2 text-amber-600 font-medium">{{ 'home.dueTomorrow' | translate }}</span>
                  } @else {
                    <span class="ml-2 text-muted-foreground">Em {{ inst.days_until_due }} dias</span>
                  }
                </p>
              </div>
              <div class="text-right">
                <p class="font-semibold text-foreground">{{ inst.remaining_amount | localizedCurrency:'symbol':'1.2-2' }}</p>
                @if (inst.paid_amount > 0) {
                  <p class="text-xs text-emerald-600">
                    {{ 'home.paid' | translate }}: {{ inst.paid_amount | localizedCurrency:'symbol':'1.2-2' }}
                  </p>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Quick Stats -->
  @if (loading()) {
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      @for (i of [1,2,3]; track i) {
        <div class="card p-6">
          <div class="flex items-center">
            <div class="w-10 h-10 bg-slate-200 rounded-lg animate-pulse mr-4"></div>
            <div class="flex-1">
              <div class="h-4 w-24 bg-slate-200 rounded animate-pulse mb-2"></div>
              <div class="h-8 w-20 bg-slate-200 rounded animate-pulse"></div>
            </div>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="card p-6">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
            <lucide-icon [img]="Users" class="text-blue-600"></lucide-icon>
          </div>
          <div>
            <p class="text-sm text-muted-foreground">{{ 'home.totalClients' | translate }}</p>
            <p class="text-2xl font-bold text-foreground">{{ metrics().total_clients }}</p>
          </div>
        </div>
      </div>

      <div class="card p-6">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center mr-4">
            <lucide-icon [img]="CreditCard" class="text-emerald-600"></lucide-icon>
          </div>
          <div>
            <p class="text-sm text-muted-foreground">{{ 'home.totalExpected' | translate }}</p>
            <p class="text-2xl font-bold text-foreground">{{ metrics().total_expected | localizedCurrency:'symbol':'1.0-0' }}</p>
          </div>
        </div>
      </div>

      <div class="card p-6">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-4">
            <lucide-icon [img]="AlertTriangle" class="text-red-600"></lucide-icon>
          </div>
          <div>
            <p class="text-sm text-muted-foreground">{{ 'home.totalOverdue' | translate }}</p>
            <p class="text-2xl font-bold text-red-600">{{ metrics().total_overdue | localizedCurrency:'symbol':'1.0-0' }}</p>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Line Chart - Evolução Mensal -->
    <div class="card p-6">
      <div class="mb-4">
        <h3 class="text-lg font-semibold text-foreground flex items-center">
          <lucide-icon [img]="TrendingUp" class="text-blue-600 mr-2"></lucide-icon>
          {{ 'home.monthlyEvolution' | translate }}
        </h3>
        <p class="text-sm text-muted-foreground mt-1">{{ 'home.monthlyEvolutionSubtitle' | translate }}</p>
      </div>
      @if (loadingCharts()) {
        <div class="h-64 space-y-3">
          <div class="h-8 bg-slate-200 rounded animate-pulse"></div>
          <div class="h-48 bg-slate-200 rounded animate-pulse"></div>
        </div>
      } @else {
        <div class="h-64">
          <canvas baseChart
            [data]="lineChartData()"
            [options]="lineChartOptions"
            type="line">
          </canvas>
        </div>
      }
    </div>

    <!-- Doughnut Chart - Status das Parcelas -->
    <div class="card p-6">
      <div class="mb-4">
        <h3 class="text-lg font-semibold text-foreground flex items-center">
          <lucide-icon [img]="TrendingUp" class="text-emerald-600 mr-2"></lucide-icon>
          {{ 'home.installmentStatus' | translate }}
        </h3>
        <p class="text-sm text-muted-foreground mt-1">{{ 'home.installmentStatusSubtitle' | translate }}</p>
      </div>
      @if (loadingCharts()) {
        <div class="h-64 flex items-center justify-center">
          <div class="w-48 h-48 bg-slate-200 rounded-full animate-pulse"></div>
        </div>
      } @else {
        <div class="h-64">
          <canvas baseChart
            [data]="doughnutChartData()"
            [options]="doughnutChartOptions"
            type="doughnut">
          </canvas>
        </div>
      }
    </div>
  </div>
</div>
